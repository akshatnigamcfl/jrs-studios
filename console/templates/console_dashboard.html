{% extends "console-layout/layout.html" %}
 
{% block page_title %}
    Dashboard
{% endblock  %}

{% block main_body %}
<script src="/static/assets/js/fetch.js"></script>
<script src="/static/assets/js/poper.js"></script>
<script src="/static/assets/js/number_with_commas.js"></script>
    <span class="text-2xl text-slate-100 border-b">Dashboard</span>
    <div class="m-3 self-start">
      <select class="dashboard_date_selector h-8 w-32 rounded-lg p-1">
        <option disabled selected >This Month</option>
        <option value='today'>Today</option>
        <option value='this_week' >This Week</option>
        <option value='this_month' >This Month</option>
        <option value='this_year'>This Year</option>
      </select>
    </div>
        {% comment %} <div class="w-full  h-[50px] flex items-center justify-end">
        </div> {% endcomment %}
        <div class="flex justify-between mt-4 mb-4">
            <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Payment
                  </h3>
                  <p class="total_payments mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                  </p>
                  <script>
                    const total_payments_list = [
                    {% for p in payment.total_payment %}
                      {{p.amount}},
                    {% endfor %}
                    ];
                    const total_payments = document.querySelector('.total_payments');
                    total_payments.innerText = numberWithCommas(total_payments_list.reduce((a, b) => a + b))
                    console.log(total_payments)
                  </script>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Payment Pending
                  </h3>
                  <p class="pending_payment mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                  </p>
                  <script>
                    const pending_payment_list = [
                      {% for p in payment.total_payment %}
                        {{p.pending_payment}},
                      {% endfor %}
                    ];
                    const pending_payment = document.querySelector('.pending_payment');
                    pending_payment.innerText = numberWithCommas(pending_payment_list.reduce((a,b)=>a+b))
                  </script>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Bookings
                  </h3>
                  <p class="booking_count mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                  </p>
                  <script>
                    const booking_count_list = [
                    {% for p in payment.booking %}
                      '{{p}}',
                    {% endfor %}
                    ];
                    const booking_count = document.querySelector('.booking_count')
                    booking_count.innerText = booking_count_list.length
                  </script>
                </div>
              </div>
              
              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Clients
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    {{payment.client}}
                  </p>
                </div>
              </div>
        </div>


        {% comment %} <div class="flex justify-between mb-4">
            <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Invoice Generated
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    123
                  </p>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Quotations
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    123
                  </p>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Total Payment
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    123
                  </p>
                </div>
              </div>
              
              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Birthday/Anniversaries
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    123
                  </p>
                </div>
              </div>
        </div> {% endcomment %}

        <div class="flex justify-between mb-4">
            <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Pre Wedding
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    {{payment.pre_wedding}}
                  </p>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Wedding
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    {{payment.wedding}}
                  </p>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Events
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    {{payment.events}}
                  </p>
                </div>
              </div>

              <div class="dashboard_card flex flex-col w-72 bg-white border border-t-8 border-t-amber-400 shadow-sm duration-300 rounded-xl dark:bg-slate-900 dark:border-gray-700 dark:border-t-blue-500 dark:shadow-slate-700/[.7]">
                <div class="p-4 md:p-5">
                  <h3 class="text-lg text-md text-center font-medium text-gray-800 dark:text-white">
                    Reels
                  </h3>
                  <p class="mt-6 text-gray-500 font-bold text-2xl text-center dark:text-gray-400">
                    {{payment.reels}}
                  </p>
                </div>
              </div>
        </div>



        <script>
            const dashboard_card = document.querySelectorAll('.dashboard_card');
            dashboard_card.forEach(e=>{
                e.addEventListener('mouseenter', ()=>{
                    e.classList.remove('border-t-amber-400')
                    e.classList.add('border-t-teal-400')
                })
            })

            dashboard_card.forEach(e=>{
                e.addEventListener('mouseleave', ()=>{
                    e.classList.add('border-t-amber-400')
                    e.classList.remove('border-t-teal-400')
                })
            })

            const dashboard_date_selector = document.querySelector('.dashboard_date_selector');
            dashboard_date_selector.addEventListener('change',async ()=>{
              let token = JSON.parse(localStorage.getItem('token')).access
              let a = await ftN( '{% url "console_dashboard" %}','POST',{'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`}, JSON.stringify({'date_selector': dashboard_date_selector.value}))
              if (a){
                //console.log('a',a)
                if (a.status === 200){
                  console.log('a.data',a.data)
                  poperFunction(a.status,a.message,false)
                } else {
                  poperFunction(a.status,a.message,false)
                }
              }
            })

        </script>


        <span class="text-2xl text-slate-100 border-b">Upcoming Bookings</span>
        <div class="flex flex-col  bg-slate-100 rounded-xl p-4 my-4 w-full">
            <span class="text-sm text-end text-slate-900"><a href="#" class="hover:text-blue-500 text-blue-700">View All</a></span>
            <div class="-m-1.5 overflow-x-auto">
                <div class="p-1.5 min-w-full inline-block align-middle">
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                              <tr>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Client Name</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Date</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Event Type</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Requirement</th>
                                <th scope="col" class="px-6 py-3 text-end text-xs font-medium text-gray-500 uppercase">Action</th>
                              </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">


                              {% for d in data %}

                              {% comment %} {{d}} {% endcomment %}
                              
                              <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200 capitalize">{{d.data.user}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200">{{d.date}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{d.data.package.segment}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200"> {% for as in d.date.additional_service.all %} {{as.count}} - {{as}}<br> {% endfor %}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-end text-sm font-medium">
                                  <button type="button" class="inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent text-blue-600 hover:text-blue-800 disabled:opacity-50 disabled:pointer-events-none dark:text-blue-500 dark:hover:text-blue-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">
                                     <a href="http://localhost:8000/console/client-edit?id={{d.data.user.id}}&sec=booking"><button type="button" data-id={{r.id}} class="edit py-2 px-2 w-16 flex justify-center items-center inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">Edit</button></a>
                                    {% comment %}<button type="button" data-id={{r.id}} data-cover-picture="/static/{{r.cover_picture}}" class="delete_pre_wedding py-2 px-2 w-16 flex justify-center items-center inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">Delete</button> {% endcomment %}
                                </button>
                                </td>
                              </tr>
                              
                              {% endfor %}
                              
                              {% comment %} <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-end text-sm font-medium">
                                  <button type="button" class="inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent text-blue-600 hover:text-blue-800 disabled:opacity-50 disabled:pointer-events-none dark:text-blue-500 dark:hover:text-blue-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">{{pages}}</button>
                                </td>
                              </tr> {% endcomment %}
                              
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        {% comment %} <span class="text-2xl mt-6 text-slate-100">Upcoming Birthday / Anniversaries</span>
        <div class="flex flex-col bg-slate-100 rounded-xl p-4 mt-4">
            <span class="text-sm text-end text-slate-900"><a href="#" class="hover:text-blue-500 text-blue-700">View All</a></span>
            <div class="-m-1.5 overflow-x-auto">
                <div class="p-1.5 min-w-full inline-block align-middle">
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                              <tr>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Date</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Client Name</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Event Type</th>
                                <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Requirement</th>
                                <th scope="col" class="px-6 py-3 text-end text-xs font-medium text-gray-500 uppercase">Action</th>
                              </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
        
                              <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200">29-sept-2024</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">Manish Pal</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">Pre wedding shoot</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">Candid Photographer</td>
                                <td class="px-6 py-4 whitespace-nowrap text-end text-sm font-medium">
                                  <button type="button" class="inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent text-blue-600 hover:text-blue-800 disabled:opacity-50 disabled:pointer-events-none dark:text-blue-500 dark:hover:text-blue-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">
                                    <button type="button" data-id={{r.id}} class="edit py-2 px-2 w-16 flex justify-center items-center inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">Edit</button>
                                    <button type="button" data-id={{r.id}} data-cover-picture="/static/{{r.cover_picture}}" class="delete_pre_wedding py-2 px-2 w-16 flex justify-center items-center inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">Delete</button>
                                </button>
                                </td>
                              </tr>
                              <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200">{{ pages }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-end text-sm font-medium">
                                  <button type="button" class="inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent text-blue-600 hover:text-blue-800 disabled:opacity-50 disabled:pointer-events-none dark:text-blue-500 dark:hover:text-blue-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600">{{pages}}</button>
                                </td>
                              </tr>
                              
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div> {% endcomment %}
{% endblock  %}
